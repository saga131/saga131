<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>coppersmith铜匠入门 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="芝士就是力量">
<meta property="og:type" content="article">
<meta property="og:title" content="coppersmith铜匠入门">
<meta property="og:url" content="http://example.com/2024/09/01/coppersmith%E9%93%9C%E5%8C%A0%E5%85%A5%E9%97%A8/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="芝士就是力量">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-09-01T12:30:00.000Z">
<meta property="article:modified_time" content="2024-09-19T12:21:14.221Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-coppersmith铜匠入门" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/09/01/coppersmith%E9%93%9C%E5%8C%A0%E5%85%A5%E9%97%A8/" class="article-date">
  <time class="dt-published" datetime="2024-09-01T12:30:00.000Z" itemprop="datePublished">2024-09-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      coppersmith铜匠入门
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>芝士就是力量</p>
<span id="more"></span>



<h3 id="芝士"><a href="#芝士" class="headerlink" title="芝士"></a>芝士</h3><p><a target="_blank" rel="noopener" href="https://tanglee.top/2022/03/27/SageMath%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B/">SageMath简明教程 | tl2cents blog (tanglee.top)</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))   # x是规定下面方程的自变量， PolynomialRing()是与环有关，Zmod规定了环的模数</span><br><span class="line"></span><br><span class="line">f = (x + 1) ^ 2   	# 定义了一个式子</span><br><span class="line"></span><br><span class="line">f = f.monic()    	# 将多项式首项的系数化为一</span><br><span class="line"></span><br><span class="line">res = f.roots()   	# 或者small_roots()  # res现在是列表</span><br><span class="line"></span><br><span class="line">res = int(res[0]) 	# 把res的sage.rings.integer.Integer环域改成int，或者用ZZ(res[0])也行</span><br><span class="line">...</span><br></pre></td></tr></table></figure>





<h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><ol>
<li>先把最少能small_roots()的未知数界限推出来，用这个：[coppersmith small_roots未知位数检测.ipynb](C:\Users\21469\Desktop\coppersmith small_roots未知位数检测.ipynb) 保险起见，算出来的位数实际用减一，例如在1024位pq下算出455，用454；在512位pq下算出227，用226</li>
<li>查看coppersmith small_roots()所需要的位数是否满足，有时候需要爆破几位</li>
<li>编写脚本，确定f 方程（本人目前不会，解多项式原理不懂，一开始以为是把类似x**2 + 2*x + 1 &#x3D; 0 左边当成f方程来解方程，但是在下面遇到了右边单独放了p并不是0）</li>
<li>得到缺陷q本身，解rsa</li>
</ol>
<h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><h4 id="NSSCTF工坊-RSA4-P8"><a href="#NSSCTF工坊-RSA4-P8" class="headerlink" title="NSSCTF工坊[RSA4]P8"></a>NSSCTF工坊[RSA4]P8</h4><ul>
<li><p>题目</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;NSSCTF&#123;******&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">n = p*q</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;m = <span class="subst">&#123;m&gt;&gt;<span class="number">100</span>&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 1527542955109141740955682973826193262775892499957309448026045241470857728195657663426381459817190647872750820593934305392986732687654051540838628636529717414135863605586498459487983117670942529496973140251670874510207985224170313618738268651184582186637089407746738836054395760157095709388670653150429457223183161697730087281761369404956762102465246289770300941300936135728738323821631682286737786472020790680432476428922187234364341215016265407571963282147129157</span></span><br><span class="line"><span class="string">m = 2214226572250613833249705195927505959981823363137633354626532745196588970707</span></span><br><span class="line"><span class="string">c = 22113876206623661468496987580282614626160320529328454393375952035910523390370709980915981609422504775420007441257006956611997263223244837790238493516238723139514158563675396731542096229586616735753203254810465452822757959264870210654015436735165961713016222816604825816304606749448517022584926571828009062411578367333</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

</li>
<li><p>解析</p>
<p>   m缺少了低位100位，也就是高位泄露了，那么原本完整的m可以构成这个式子<br>  $$<br>  m &#x3D; m_high + x<br>  $$<br>  x为m的低位，而m_high用上面的m乘上2**100提高到原本的高位(演示如下)</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">	 m = 10101010111010100010101  	# 原本的m	</span><br><span class="line">	 m = 10101010111  				# m右移一定位数后</span><br><span class="line">m_high = 10101010111000000000000    # 乘上对应的数，让对应的10到达原本的未知，剩下后面我们补上的0就由x来补上 </span><br></pre></td></tr></table></figure>

<p>  综上，问题就转移到求<code>x</code>身上，我们来用已知条件和式子来构造一个方程式</p>
<p>  已知 m， c，n，e<br>  $$<br>  c &#x3D; m^e \pmod n<br>  $$<br>  那么有<br>  $$<br>  m^e - c &#x3D; 0 \pmod n<br>  $$<br>  m展开得到<br>  $$<br>  (m_high + x)^e - c &#x3D; 0 \pmod n<br>  $$<br>  这下我们获得了所有解题思路，接下来写代码</p>
</li>
<li><p>exp</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sagemath 9.3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">1527542955109141740955682973826193262775892499957309448026045241470857728195657663426381459817190647872750820593934305392986732687654051540838628636529717414135863605586498459487983117670942529496973140251670874510207985224170313618738268651184582186637089407746738836054395760157095709388670653150429457223183161697730087281761369404956762102465246289770300941300936135728738323821631682286737786472020790680432476428922187234364341215016265407571963282147129157</span></span><br><span class="line">m = <span class="number">2214226572250613833249705195927505959981823363137633354626532745196588970707</span></span><br><span class="line">c = <span class="number">22113876206623661468496987580282614626160320529328454393375952035910523390370709980915981609422504775420007441257006956611997263223244837790238493516238723139514158563675396731542096229586616735753203254810465452822757959264870210654015436735165961713016222816604825816304606749448517022584926571828009062411578367333</span></span><br><span class="line"></span><br><span class="line">m_high = m&lt;&lt;<span class="number">100</span></span><br><span class="line"></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = (m_high + x)**<span class="number">3</span> - c</span><br><span class="line">f = f.monic()</span><br><span class="line">m0 = f.small_roots()</span><br><span class="line"><span class="built_in">print</span>(m0)</span><br><span class="line">m = m_high + m0[<span class="number">0</span>]</span><br><span class="line">flag = long_to_bytes(<span class="built_in">int</span>(m)).decode()</span><br><span class="line"><span class="built_in">print</span>(flag) <span class="comment"># NSSCTF&#123;688404a6-c408-4196-bc43-7f18317a9170&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="NSSCTF工坊-RSA4-P9（构造多项式不懂，为什么右边不是0，而是p）"><a href="#NSSCTF工坊-RSA4-P9（构造多项式不懂，为什么右边不是0，而是p）" class="headerlink" title="NSSCTF工坊[RSA4]P9（构造多项式不懂，为什么右边不是0，而是p）"></a>NSSCTF工坊[RSA4]P9（构造多项式不懂，为什么右边不是0，而是p）</h4><ul>
<li><p>题目</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;NSSCTF&#123;******&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">n = p*q</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;p = <span class="subst">&#123;p&gt;&gt;<span class="number">100</span>&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 64335017257291288694879798080666629573501118113377179370850991421806469826103134483305987256497147128148330360834028920504233940886960965527818740354522230977284177508093687651712761343376265176857120577153061490788347779327206437787594150381508592990273475278503352979893670354730287704989079247190299342871</span></span><br><span class="line"><span class="string">p = 7550547038897825994210519739007596111285476244196123253081036462313916767780871742001683690783926938603422562506786339392389</span></span><br><span class="line"><span class="string">c = 63156227746402147833665215816432368072100003179308515827461336094419526246728847463629131014545663919689064970828884371592840335299717484415279040662500514230579275586231051576688620810169339105201465431624989678170362157914366609856305650090630980489686792938272599406165204410721499875713189193728688835223</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

</li>
<li><p>解析</p>
<p>  p高位泄露</p>
<p>  <a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/sheet/10398">Crypto系列——RSA（四） | NSSCTF</a></p>
</li>
<li><p>exp</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sagemath 9.3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">64335017257291288694879798080666629573501118113377179370850991421806469826103134483305987256497147128148330360834028920504233940886960965527818740354522230977284177508093687651712761343376265176857120577153061490788347779327206437787594150381508592990273475278503352979893670354730287704989079247190299342871</span></span><br><span class="line">p = <span class="number">7550547038897825994210519739007596111285476244196123253081036462313916767780871742001683690783926938603422562506786339392389</span></span><br><span class="line">c = <span class="number">63156227746402147833665215816432368072100003179308515827461336094419526246728847463629131014545663919689064970828884371592840335299717484415279040662500514230579275586231051576688620810169339105201465431624989678170362157914366609856305650090630980489686792938272599406165204410721499875713189193728688835223</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">p_high = p&lt;&lt;<span class="number">100</span>  <span class="comment"># 乘上2**100一样作用</span></span><br><span class="line"></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line"></span><br><span class="line">f = p_high + x</span><br><span class="line">f = f.monic()</span><br><span class="line">out_p = f.small_roots(<span class="number">2</span>^<span class="number">100</span>,<span class="number">0.4</span>)</span><br><span class="line"><span class="built_in">print</span>(out_p)</span><br><span class="line">p = <span class="built_in">int</span>(p_high + out_p[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">assert</span> n % p == <span class="number">0</span></span><br><span class="line">q = n // p</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse(e, phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">flag = long_to_bytes(<span class="built_in">int</span>(m)).decode()</span><br><span class="line"><span class="built_in">print</span>(flag) <span class="comment"># NSSCTF&#123;36a5ae48-f281-4576-8d1f-acab0666bff2&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="BaseCTF2024-Week2-铜匠"><a href="#BaseCTF2024-Week2-铜匠" class="headerlink" title="BaseCTF2024 [Week2]铜匠"></a>BaseCTF2024 [Week2]铜匠</h4><ul>
<li><p>题目</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long</span><br><span class="line"><span class="comment">#from secret import flag</span></span><br><span class="line">flag=<span class="string">b&#x27;XXXX&#x27;</span></span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">hint1 = p &gt;&gt; <span class="number">721</span></span><br><span class="line">hint2 = q % (<span class="number">2</span> ** <span class="number">266</span>)</span><br><span class="line">ct = <span class="built_in">pow</span>(bytes_to_long(flag), e, n)</span><br><span class="line"><span class="built_in">print</span>(hint1)</span><br><span class="line"><span class="built_in">print</span>(hint2)</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(ct)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">hint1 = 14439249591349619691972392177790365247490839237199085979433418493254022567815148979672690178</span></span><br><span class="line"><span class="string">hint2 = 90063199151369157959005663017593053931871580139169245885113098598755909124764417</span></span><br><span class="line"><span class="string">n = 18347545778876678838092757800261556931131930866012101566000425608407193858675622059415995283684230959320874387944052648148677918542763633503231962873204645415818139345588988936580526094727943067102768943117592654029397879665312089518191052154267343886226820785206334238961064175118262578895847281575656290248049404047727756356910896332939145136942219317065063060070725033146788186604738271846183709127655298440696824683099637827282095133642324657860714680107691622056420045091586609974536644773286992447027164350612852922016376888380895187804771279035652496676089183636450028327097084911908336202253562671798012457461</span></span><br><span class="line"><span class="string">ct = 15659576879410368237140555530527974801613150473447768911067611094143466009251385693099110691602954207905029692682380253595062935017486879899242785756448973466690818942065250284891341066578689696180061755610538867770441139827574063212967027249650509215685566103350688284041405586915563454117672061141919712416360596137520514412607512596079964611672166435592936417138352662031529414118312166411150736015788925026636845744110093161894267707446937939130745326244186579516665160036229715964182962542836836457885170975474737620430886449029488829662146456489724775166105816909257516908496172172266375617868819982791477888289</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

</li>
<li><p>解析</p>
<p>  下面鹤城杯的简易版，把p的未知位数改小了，刚好可以不用爆破得到p</p>
<p>  在查small_root()参数要求时，找到了原题<strong>鹤城杯2021，babyrsa</strong></p>
<p>  文章<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_51999772/article/details/123620932">RSA中coppersmith定理的应用条件_sagemath coppersmith-CSDN博客</a></p>
<p>  测试一下在pq均为1024位下，未知量需要控制在多少一下才能使得small_root()有解</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sagemath 9.3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime</span><br><span class="line">p = getPrime(<span class="built_in">int</span>(<span class="number">1024</span>)) <span class="comment"># 1024可根据题意修改，若p，q不同位，请访问https://blog.csdn.net/qq_51999772/article/details/123620932</span></span><br><span class="line">q = getPrime(<span class="built_in">int</span>(<span class="number">1024</span>))</span><br><span class="line">n = p * q</span><br><span class="line">test_bits = <span class="number">455</span> <span class="comment"># 调节未知数大小</span></span><br><span class="line">p_h = p &gt;&gt; test_bits</span><br><span class="line">R.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = (p_h &lt;&lt; test_bits) + x</span><br><span class="line">f.small_roots(<span class="number">2</span>**test_bits,<span class="number">0.4</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<p>​	这里关于f 方程 等号右边为什么不是0还是存有疑惑</p>
<ul>
<li><p>exp</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sagemath 9.3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">hint1 = <span class="number">14439249591349619691972392177790365247490839237199085979433418493254022567815148979672690178</span></span><br><span class="line">hint2 = <span class="number">90063199151369157959005663017593053931871580139169245885113098598755909124764417</span></span><br><span class="line">n = <span class="number">18347545778876678838092757800261556931131930866012101566000425608407193858675622059415995283684230959320874387944052648148677918542763633503231962873204645415818139345588988936580526094727943067102768943117592654029397879665312089518191052154267343886226820785206334238961064175118262578895847281575656290248049404047727756356910896332939145136942219317065063060070725033146788186604738271846183709127655298440696824683099637827282095133642324657860714680107691622056420045091586609974536644773286992447027164350612852922016376888380895187804771279035652496676089183636450028327097084911908336202253562671798012457461</span></span><br><span class="line">ct = <span class="number">15659576879410368237140555530527974801613150473447768911067611094143466009251385693099110691602954207905029692682380253595062935017486879899242785756448973466690818942065250284891341066578689696180061755610538867770441139827574063212967027249650509215685566103350688284041405586915563454117672061141919712416360596137520514412607512596079964611672166435592936417138352662031529414118312166411150736015788925026636845744110093161894267707446937939130745326244186579516665160036229715964182962542836836457885170975474737620430886449029488829662146456489724775166105816909257516908496172172266375617868819982791477888289</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">p_high = hint1</span><br><span class="line">q_low = hint2</span><br><span class="line">mod = <span class="number">2</span> ** <span class="number">266</span></span><br><span class="line">q_low_lnv = inverse(q_low, mod)</span><br><span class="line">p_low = n*q_low_lnv % mod</span><br><span class="line"></span><br><span class="line">i = <span class="number">721</span> - <span class="number">266</span> - <span class="number">455</span> <span class="comment"># i是p距离small_root成功所需要的位数还缺的位数（用来爆破），455是用另一个py文件推出来的</span></span><br><span class="line"><span class="built_in">print</span>(i)</span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line"><span class="keyword">if</span> i != <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**i):</span><br><span class="line">        f = p_high * (<span class="number">2</span>**<span class="number">721</span>) + p_low + (x*<span class="number">32</span>  + j) * mod <span class="comment"># 这里的32是步长</span></span><br><span class="line">        f = f.monic()</span><br><span class="line">        out_p = f.small_root(<span class="number">2</span>**<span class="number">455</span>,<span class="number">0.4</span>)</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">len</span>(out_p) != <span class="number">0</span>): </span><br><span class="line">            <span class="built_in">print</span>(out_p)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    p = (out_p[<span class="number">0</span>]*<span class="number">32</span> + j) * mod + p_high * (<span class="number">2</span>**<span class="number">721</span>) + p_low</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    f = p_high * (<span class="number">2</span>**<span class="number">721</span>) + p_low + (x*<span class="number">32</span>) * <span class="number">2</span>**<span class="number">266</span></span><br><span class="line">    f = f.monic()</span><br><span class="line">    out_p = f.small_roots(<span class="number">2</span>**<span class="number">455</span>,<span class="number">0.4</span>)</span><br><span class="line">    p = p_high * (<span class="number">2</span>**<span class="number">721</span>) + p_low + (out_p[<span class="number">0</span>]*<span class="number">32</span>) * <span class="number">2</span>**<span class="number">266</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = <span class="built_in">int</span>(p)</span><br><span class="line"><span class="keyword">assert</span> n%p == <span class="number">0</span></span><br><span class="line">q = n//p</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse(e, phi)</span><br><span class="line">m = <span class="built_in">pow</span>(ct, d, n)</span><br><span class="line">flag = long_to_bytes(<span class="built_in">int</span>(m))</span><br><span class="line"><span class="built_in">print</span>(flag.decode())</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="鹤城杯2021-babyrsa"><a href="#鹤城杯2021-babyrsa" class="headerlink" title="鹤城杯2021 babyrsa"></a>鹤城杯2021 babyrsa</h4><ul>
<li><p>题目</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">hint1 = p &gt;&gt; <span class="number">724</span></span><br><span class="line">hint2 = q % (<span class="number">2</span> ** <span class="number">265</span>)</span><br><span class="line">ct = <span class="built_in">pow</span>(bytes_to_long(flag), e, n)</span><br><span class="line"><span class="built_in">print</span>(hint1)</span><br><span class="line"><span class="built_in">print</span>(hint2)</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(ct)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">hint1 = 1514296530850131082973956029074258536069144071110652176122006763622293335057110441067910479</span></span><br><span class="line"><span class="string">hint2 = 40812438243894343296354573724131194431453023461572200856406939246297219541329623</span></span><br><span class="line"><span class="string">n = 21815431662065695412834116602474344081782093119269423403335882867255834302242945742413692949886248581138784199165404321893594820375775454774521554409598568793217997859258282700084148322905405227238617443766062207618899209593375881728671746850745598576485323702483634599597393910908142659231071532803602701147251570567032402848145462183405098097523810358199597631612616833723150146418889589492395974359466777040500971885443881359700735149623177757865032984744576285054725506299888069904106805731600019058631951255795316571242969336763938805465676269140733371287244624066632153110685509892188900004952700111937292221969</span></span><br><span class="line"><span class="string">ct = 19073695285772829730103928222962723784199491145730661021332365516942301513989932980896145664842527253998170902799883262567366661277268801440634319694884564820420852947935710798269700777126717746701065483129644585829522353341718916661536894041337878440111845645200627940640539279744348235772441988748977191513786620459922039153862250137904894008551515928486867493608757307981955335488977402307933930592035163126858060189156114410872337004784951228340994743202032248681976932591575016798640429231399974090325134545852080425047146251781339862753527319093938929691759486362536986249207187765947926921267520150073408188188</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

</li>
<li><p>解析</p>
<p>  有5位需要爆破，如果你用上面的脚本，会发现test_bits&#x3D;455也是可以出结果的，但是我在实际应用中发现455并不能出结果，所以要减一</p>
</li>
<li><p>exp</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sagemath 9.3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">hint1 = <span class="number">1514296530850131082973956029074258536069144071110652176122006763622293335057110441067910479</span></span><br><span class="line">hint2 = <span class="number">40812438243894343296354573724131194431453023461572200856406939246297219541329623</span></span><br><span class="line">n = <span class="number">21815431662065695412834116602474344081782093119269423403335882867255834302242945742413692949886248581138784199165404321893594820375775454774521554409598568793217997859258282700084148322905405227238617443766062207618899209593375881728671746850745598576485323702483634599597393910908142659231071532803602701147251570567032402848145462183405098097523810358199597631612616833723150146418889589492395974359466777040500971885443881359700735149623177757865032984744576285054725506299888069904106805731600019058631951255795316571242969336763938805465676269140733371287244624066632153110685509892188900004952700111937292221969</span></span><br><span class="line">ct = <span class="number">19073695285772829730103928222962723784199491145730661021332365516942301513989932980896145664842527253998170902799883262567366661277268801440634319694884564820420852947935710798269700777126717746701065483129644585829522353341718916661536894041337878440111845645200627940640539279744348235772441988748977191513786620459922039153862250137904894008551515928486867493608757307981955335488977402307933930592035163126858060189156114410872337004784951228340994743202032248681976932591575016798640429231399974090325134545852080425047146251781339862753527319093938929691759486362536986249207187765947926921267520150073408188188</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">p_high = hint1</span><br><span class="line">q_low = hint2</span><br><span class="line">mod = <span class="number">2</span> ** <span class="number">265</span></span><br><span class="line"></span><br><span class="line">q_low_lnv = inverse(q_low, mod)</span><br><span class="line">p_low = n*q_low_lnv % mod</span><br><span class="line"></span><br><span class="line">k = <span class="number">724</span> - <span class="number">265</span> - <span class="number">455</span> + <span class="number">1</span>  <span class="comment"># 要加一</span></span><br><span class="line"><span class="built_in">print</span>(k)</span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**k):</span><br><span class="line">    f = p_high*(<span class="number">2</span>**<span class="number">724</span>) + p_low + (x*<span class="number">32</span> + i)*mod</span><br><span class="line">    f = f.monic()</span><br><span class="line">    out_p = f.small_roots(<span class="number">2</span>**<span class="number">454</span>, <span class="number">0.4</span>)  <span class="comment"># small_roots别写错成small_root啦</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(out_p) != <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(out_p[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">p = p_high*(<span class="number">2</span>**<span class="number">724</span>) + p_low + (out_p[<span class="number">0</span>]*<span class="number">32</span> + i)*mod</span><br><span class="line">p = <span class="built_in">int</span>(p)</span><br><span class="line"><span class="keyword">assert</span> n%p==<span class="number">0</span></span><br><span class="line">q = n//p</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse(e, phi)</span><br><span class="line">m = <span class="built_in">pow</span>(ct, d, n)</span><br><span class="line">flag = long_to_bytes(<span class="built_in">int</span>(m)).decode()  <span class="comment"># 记得把m 给int()</span></span><br><span class="line"><span class="built_in">print</span>(flag) <span class="comment"># flag&#123;ef5e1582-8116-4f61-b458-f793dc03f2ff&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="NSSCTF工坊-RSA4-P10（原理未解）"><a href="#NSSCTF工坊-RSA4-P10（原理未解）" class="headerlink" title="NSSCTF工坊[RSA4]P10（原理未解）"></a>NSSCTF工坊[RSA4]P10（原理未解）</h4><ul>
<li>题目</li>
<li>解析</li>
<li>exp</li>
</ul>
<h4 id="XYCTF2024-铜匠-9-19更新"><a href="#XYCTF2024-铜匠-9-19更新" class="headerlink" title="XYCTF2024 铜匠        #9&#x2F;19更新"></a>XYCTF2024 铜匠        #9&#x2F;19更新</h4><ul>
<li><p>题目</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">m1 = getRandomRange(<span class="number">1</span>, m)</span><br><span class="line">m2 = getRandomRange(<span class="number">1</span>, m)</span><br><span class="line">m3 = m - m1 - m2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task1</span>():</span><br><span class="line">    e = <span class="number">149</span></span><br><span class="line">    p = getPrime(<span class="number">512</span>)</span><br><span class="line">    q = getPrime(<span class="number">512</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    d = inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">pow</span>(m1, e, n), d &gt;&gt; <span class="number">222</span> &lt;&lt; <span class="number">222</span>, n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task2</span>():</span><br><span class="line">    e = <span class="number">65537</span></span><br><span class="line">    p = getPrime(<span class="number">1024</span>)</span><br><span class="line">    q = getPrime(<span class="number">1024</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">pow</span>(m2, e, n), (p + q) &amp; ((<span class="number">1</span> &lt;&lt; <span class="number">624</span>) - <span class="number">1</span>), n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task3</span>():</span><br><span class="line">    e = <span class="number">65537</span></span><br><span class="line">    p = getPrime(<span class="number">512</span>)</span><br><span class="line">    q = getPrime(<span class="number">512</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">pow</span>(m3, e, n), (p ^ q) &gt;&gt; <span class="number">200</span>, n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c1, leak1, n1 = task1()</span><br><span class="line">c2, leak2, n2 = task2()</span><br><span class="line">c3, leak3, n3 = task3()</span><br><span class="line"><span class="built_in">print</span>(c1, leak1, n1)</span><br><span class="line"><span class="built_in">print</span>(c2, leak2, n2)</span><br><span class="line"><span class="built_in">print</span>(c3, leak3, n3)</span><br><span class="line"><span class="comment"># (89623543982221289730635223555830551523170205418976759060541832483843039074358160566735322009158596405712449020903311144480669706226166537602750967447480664875090686428406188847601970724994074417752345460791736191511081890913041143570455636020205647345764692062144226011846336769477026234106683791286490222089, 138474880017294332349992670187778287774153347391371789199005713563195654993662610111557185709277805165708109047494971468100563949333712521647405765501704478862377527360106399421209690341743821320754482338590671565510629203215009008479290995785318405211007685664887994061938667418220613430135743123498167435264, 146331610798417415036517077006943013321623040860385791423062775325646472298267580898028515394910588437521335092742913111680737790430660749825981979147191282007208147041227246620008377726207734522466015971515317594545750944838673018946440525615131606652748549901880641896940968837669894325535750125282351577689)</span></span><br><span class="line"><span class="comment"># (5473961166821344576614003060897848014482672788904094340704447882490091115468180944569409159343222459801235179587721232166576530621751748850763430788036935832653535110975154800191323351333883661451331971042214143454441651165718504131976920077768864850035471790911190772583977173388975105970866592974077361193822302653046511418190410043729876062517148438923211673300268277037622337403526399584759202097925983596261279676101079771530118525540842499517622478819211528345668513680064744443628779623340175578509413636950545134641050948185944279029949957748464529075830770617236599864271566534714755373562527112224962839980,62964793504732923650344975634773688108135580826064134090114181449607062497690184718845295432644650580930430061411603385577783897575232298084007041511817031640186953023971498914096209984730,20748652069632848434897928314437138341436264859802586939154590237186029244907936870477844563166827587536149170710720365760129683024401957095447466056746469055173897234659911291443605912459271248059341147358511860537769587963189092648473894868209838600346115919726589891777340166174017389513260737891557712152871714337946675533597049874155202056200170954033849176655928144354665553271709442011723088448485570394208728775665739819536229908847043007472178803394055783543378990699834066614262050119443421709878598533329555838915158259138297060574425019923291353077080236769586821808150397875920110335669136563171420068201)</span></span><br><span class="line"><span class="comment"># (34640310217688693418173336791306022698488916505988760907493665070072623574363578354500529023855888624978101429772253437880445815006839767802433777006836665709335479076676231470534690281412388704665083311568028710188940132495410474044569100181764053297307413009214044407982980600917158732129850605715306726034, 3763587651775261955566046684899146246387485307521708557610018711932791630073528010801142052497, 94848869174430082173244966077736519396702141299429965725051314270443078621842166791082354594193554380275167898342497998871366256044865879909218309960595691008663632410356093966762639308253848450178310347612630814852054763933063313537694449475061227647475480417779126252294793767003555255527593551612032661749)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

</li>
<li><p>解析</p>
<p>  三个挑战，</p>
<p>  task1是d的高位泄露，看了眼NSS工坊，里面提及的是d低位泄露，在网上找到了<a target="_blank" rel="noopener" href="https://blog.csdn.net/XiongSiqi_blog/article/details/138697918?spm=1001.2014.3001.5502">Emmaaaaaaaaaa师傅的wp</a>，用的式子和d低位泄露是同一个（如下），高位就不用模$2^a$（在低位模$2^a$是因为要构造$d \equiv d_low \mod {2^a}$，a为d泄露的位数）<br>  $$<br>  e·d·p-k·p·(n-p+1)+k·n-p&#x3D;0<br>  $$<br>  这个式子是由<br>  $$<br>  e·d \equiv 1 \mod phi<br>  $$<br>  展开推导得到的</p>
<p>  其中还有一个p和k未知，因为ed与k·phi相近，d本身小于phi，则k小于e，task1的e为149，在可爆破范围内。</p>
<p>  task2</p>
<p>  已知p+q（后称low）的624低位，p、q是1024位的，通过解这个式子n&#x3D;&#x3D;X*(low - X)，得到相对应的p或q的624低位，再copper一下就能出</p>
<p>  task3</p>
<p>  p^q异或部分泄露，通过复现师傅的exp，大概理解了代码运行原理</p>
<p>  从异或结果入手，如果是1，那么p和q在对应的位置是相反的，在这个位置（p_，q_）赋予（0，1）或者（1，0），如果是0，那么就是相同的，（p_，q_）赋值（0，0）或者（1，1），得到311位的部分p后尝试copper</p>
</li>
<li><p>exp</p>
<p>  <strong>task1</strong></p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sagemath 9.3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line"></span><br><span class="line"><span class="comment">#task1</span></span><br><span class="line">c1, leak1, n1 = (<span class="number">89623543982221289730635223555830551523170205418976759060541832483843039074358160566735322009158596405712449020903311144480669706226166537602750967447480664875090686428406188847601970724994074417752345460791736191511081890913041143570455636020205647345764692062144226011846336769477026234106683791286490222089</span>, <span class="number">138474880017294332349992670187778287774153347391371789199005713563195654993662610111557185709277805165708109047494971468100563949333712521647405765501704478862377527360106399421209690341743821320754482338590671565510629203215009008479290995785318405211007685664887994061938667418220613430135743123498167435264</span>, <span class="number">146331610798417415036517077006943013321623040860385791423062775325646472298267580898028515394910588437521335092742913111680737790430660749825981979147191282007208147041227246620008377726207734522466015971515317594545750944838673018946440525615131606652748549901880641896940968837669894325535750125282351577689</span>)</span><br><span class="line">e1 = <span class="number">149</span></span><br><span class="line">dh = leak1</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_full_p</span>(<span class="params">ph, n, bits</span>):</span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    f = x + ph</span><br><span class="line">    f = f.monic()</span><br><span class="line">    res = f.small_roots(<span class="number">2</span>**(bits + <span class="number">4</span>),<span class="number">0.4</span>)</span><br><span class="line">    <span class="keyword">if</span> res != []:</span><br><span class="line">        x = res[<span class="number">0</span>]</span><br><span class="line">        p = gmpy2.gcd(<span class="built_in">int</span>(x +  ph), <span class="built_in">int</span>(n))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(p)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_ph</span>(<span class="params">e, n, dh, bits</span>):</span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(RealField(<span class="number">1000</span>))</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> trange(e+<span class="number">1</span>,<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">        f = e*dh*x - k*x*(n-x+<span class="number">1</span>) + k*n - x</span><br><span class="line">        f = f.monic()</span><br><span class="line">        results = f.roots()</span><br><span class="line">        <span class="keyword">if</span> results != []:</span><br><span class="line">            <span class="keyword">for</span> res <span class="keyword">in</span> results:</span><br><span class="line">                ph = <span class="built_in">int</span>(res[<span class="number">0</span>])</span><br><span class="line">                p = get_full_p(ph, n, bits)</span><br><span class="line">                <span class="keyword">if</span> p  <span class="keyword">and</span> p != <span class="number">1</span> <span class="keyword">and</span> p != n:</span><br><span class="line">                    <span class="keyword">return</span> <span class="built_in">int</span>(p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p1 = get_ph(e1, n1, dh, <span class="number">222</span>)</span><br><span class="line">q1 = n1//p1</span><br><span class="line">phi1 = (p1-<span class="number">1</span>)*(q1-<span class="number">1</span>)</span><br><span class="line">d1 = inverse(e1, phi1)</span><br><span class="line">m1 = <span class="built_in">pow</span>(c1, <span class="built_in">int</span>(d1), n1)</span><br><span class="line"><span class="built_in">print</span>(m1) <span class="comment">#330832831022331738585526807955460379454479582944171598101657085161515577868902054403372251911101864207527977700861276537342074608974192943774940351816501776943795657416</span></span><br></pre></td></tr></table></figure>

<p>  <strong>task2</strong></p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sagemath 9.3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_full_p2</span>(<span class="params">p_low, n</span>):</span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    nbits = n.nbits()</span><br><span class="line">    p_lowbits = p_low.nbits()</span><br><span class="line">    f = <span class="number">2</span>^p_lowbits*x + p_low</span><br><span class="line">    f = f.monic()</span><br><span class="line">    roots = f.small_roots(X=<span class="number">2</span>^(nbits//<span class="number">2</span>-p_lowbits), beta=<span class="number">0.4</span>)</span><br><span class="line">    <span class="keyword">if</span> roots != []:</span><br><span class="line">        x = roots[<span class="number">0</span>]</span><br><span class="line">        p = gmpy2.gcd(<span class="built_in">int</span>(<span class="number">2</span>^p_lowbits*x + p_low), <span class="built_in">int</span>(n))</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(p)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_p2_low</span>(<span class="params">low, n</span>):</span><br><span class="line">    X = var(<span class="string">&#x27;X&#x27;</span>)</span><br><span class="line">    results = solve_mod([n==X*(low - X)],<span class="number">2</span>^low.nbits())</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> results:</span><br><span class="line">        p_low = ZZ(x[<span class="number">0</span>])</span><br><span class="line">        p = get_full_p2(p_low, n)</span><br><span class="line">        <span class="keyword">if</span> p <span class="keyword">and</span> p != <span class="number">1</span> <span class="keyword">and</span> p != n:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">int</span>(p)</span><br><span class="line"></span><br><span class="line">c2, leak2, n2 = (<span class="number">5473961166821344576614003060897848014482672788904094340704447882490091115468180944569409159343222459801235179587721232166576530621751748850763430788036935832653535110975154800191323351333883661451331971042214143454441651165718504131976920077768864850035471790911190772583977173388975105970866592974077361193822302653046511418190410043729876062517148438923211673300268277037622337403526399584759202097925983596261279676101079771530118525540842499517622478819211528345668513680064744443628779623340175578509413636950545134641050948185944279029949957748464529075830770617236599864271566534714755373562527112224962839980</span>,<span class="number">62964793504732923650344975634773688108135580826064134090114181449607062497690184718845295432644650580930430061411603385577783897575232298084007041511817031640186953023971498914096209984730</span>,<span class="number">20748652069632848434897928314437138341436264859802586939154590237186029244907936870477844563166827587536149170710720365760129683024401957095447466056746469055173897234659911291443605912459271248059341147358511860537769587963189092648473894868209838600346115919726589891777340166174017389513260737891557712152871714337946675533597049874155202056200170954033849176655928144354665553271709442011723088448485570394208728775665739819536229908847043007472178803394055783543378990699834066614262050119443421709878598533329555838915158259138297060574425019923291353077080236769586821808150397875920110335669136563171420068201</span>)</span><br><span class="line">e2 = <span class="number">65537</span></span><br><span class="line">p2 = find_p2_low(leak2, n2)</span><br><span class="line">q2 = n2//p2</span><br><span class="line">d2 = inverse(e2, (p2-<span class="number">1</span>)*(q2-<span class="number">1</span>))</span><br><span class="line">m2 = <span class="built_in">pow</span>(c2, d2, n2)</span><br><span class="line"><span class="built_in">print</span>(m2) <span class="comment"># 637474741382124491125351127892971159828342019036405954553729272346832023284163998914076056292480317209934960796148267118196288511438260371617371342378683017480560448795</span></span><br></pre></td></tr></table></figure>

<p>  <strong>task3</strong></p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sagemath 9.3</span></span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line">c3 = <span class="number">34640310217688693418173336791306022698488916505988760907493665070072623574363578354500529023855888624978101429772253437880445815006839767802433777006836665709335479076676231470534690281412388704665083311568028710188940132495410474044569100181764053297307413009214044407982980600917158732129850605715306726034</span></span><br><span class="line">leak3 = <span class="number">3763587651775261955566046684899146246387485307521708557610018711932791630073528010801142052497</span></span><br><span class="line">n3 = <span class="number">94848869174430082173244966077736519396702141299429965725051314270443078621842166791082354594193554380275167898342497998871366256044865879909218309960595691008663632410356093966762639308253848450178310347612630814852054763933063313537694449475061227647475480417779126252294793767003555255527593551612032661749</span></span><br><span class="line">e3 = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">leak3 = leak3&lt;&lt;<span class="number">200</span></span><br><span class="line">leak3 = <span class="built_in">bin</span>(leak3)[<span class="number">2</span>:].zfill(<span class="number">512</span>)</span><br><span class="line">leakbits = <span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_leak</span>(<span class="params">pp, qq,k</span>):</span><br><span class="line">    p_min = <span class="built_in">int</span>(pp+<span class="string">&quot;0&quot;</span>*(<span class="number">512</span>-k), <span class="number">2</span>)</span><br><span class="line">    p_max = <span class="built_in">int</span>(pp+<span class="string">&quot;1&quot;</span>*(<span class="number">512</span>-k), <span class="number">2</span>)</span><br><span class="line">    q_min = <span class="built_in">int</span>(qq+<span class="string">&quot;0&quot;</span>*(<span class="number">512</span>-k), <span class="number">2</span>)</span><br><span class="line">    q_max = <span class="built_in">int</span>(qq+<span class="string">&quot;1&quot;</span>*(<span class="number">512</span>-k), <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(k == <span class="number">512</span> - leakbits):</span><br><span class="line">        PR.&lt;x&gt; = PolynomialRing(Zmod(n3))</span><br><span class="line">        ph = p_min</span><br><span class="line">        f3 = ph + x</span><br><span class="line">        res = f3.small_roots(X=<span class="number">2</span>^leakbits, beta = <span class="number">0.4</span>)</span><br><span class="line">        <span class="keyword">if</span> res != []:</span><br><span class="line">            p3 = ph + <span class="built_in">int</span>(res[<span class="number">0</span>])</span><br><span class="line">            q3 = n3//p3</span><br><span class="line">            d3 = invert(e3, (p3-<span class="number">1</span>)*(q3-<span class="number">1</span>))</span><br><span class="line">            m3 = <span class="built_in">pow</span>(c3, d3, n3)</span><br><span class="line">            <span class="built_in">print</span>(m3)</span><br><span class="line">            </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (p_max*q_max &lt; n3) <span class="keyword">or</span> (p_min * q_min &gt; n3):</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> leak3[k] == <span class="string">&quot;0&quot;</span>:</span><br><span class="line">        solve_leak(pp+<span class="string">&#x27;1&#x27;</span>, qq+<span class="string">&#x27;1&#x27;</span>,k+<span class="number">1</span>)</span><br><span class="line">        solve_leak(pp+<span class="string">&#x27;0&#x27;</span>, qq+<span class="string">&#x27;0&#x27;</span>,k+<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> leak3[k] == <span class="string">&quot;1&quot;</span>:</span><br><span class="line">        solve_leak(pp+<span class="string">&#x27;1&#x27;</span>, qq+<span class="string">&quot;0&quot;</span>, k+<span class="number">1</span>)</span><br><span class="line">        solve_leak(pp+<span class="string">&#x27;0&#x27;</span>, qq+<span class="string">&#x27;1&#x27;</span>, k+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">m3 = solve_leak(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="number">1</span>) <span class="comment"># 334132319136130454419386550847309794306389604470819859736266178647538718607667083644497296078054806893307642673035506225568447967643224450929477875810797878149197295514</span></span><br></pre></td></tr></table></figure>

<p>  flag</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">m1 = <span class="number">330832831022331738585526807955460379454479582944171598101657085161515577868902054403372251911101864207527977700861276537342074608974192943774940351816501776943795657416</span></span><br><span class="line">m2 = <span class="number">637474741382124491125351127892971159828342019036405954553729272346832023284163998914076056292480317209934960796148267118196288511438260371617371342378683017480560448795</span></span><br><span class="line">m3 = <span class="number">334132319136130454419386550847309794306389604470819859736266178647538718607667083644497296078054806893307642673035506225568447967643224450929477875810797878149197295514</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m1+m2+m3)) </span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/09/01/coppersmith%E9%93%9C%E5%8C%A0%E5%85%A5%E9%97%A8/" data-id="cm1br08970002s8qa5hth12cf" data-title="coppersmith铜匠入门" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2024/09/17/%E5%85%B1%E6%A8%A1%E6%94%BB%E5%87%BB/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          共模攻击
        
      </div>
    </a>
  
  
    <a href="/2024/08/27/%E5%86%80%E4%BF%A1%E6%9D%AF2024/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">冀信杯2024</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/09/21/first-blog/">first-blog</a>
          </li>
        
          <li>
            <a href="/2024/09/21/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2024/09/17/%E5%86%99%E5%8D%9A%E5%AE%A2%E7%9A%84%E5%B0%8F%E8%AE%B0%E5%BD%95/">写博客的小记录</a>
          </li>
        
          <li>
            <a href="/2024/09/17/%E5%85%B1%E6%A8%A1%E6%94%BB%E5%87%BB/">共模攻击</a>
          </li>
        
          <li>
            <a href="/2024/09/01/coppersmith%E9%93%9C%E5%8C%A0%E5%85%A5%E9%97%A8/">coppersmith铜匠入门</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>